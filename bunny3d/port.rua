#!/usr/bin/env rua
local vec3d = require 'vec-ffi.vec3d'
local meshstr = ([[
d3e04bf31a8dddb741631f00dbe44fcd1706
e6b440cd1dfaddb741631f00da133d261fab
ddb741631f00d3e04bf31a8dda133d261fab
f94d58ef01baf319586507af00845b4407f5
e2ef303a1d00e6b440cd1dfada133d261fab
ddb741631f00e3ea4d261942e2d555891122
e47843d51cb9e3ea4d261942ddb741631f00
e6b440cd1dfae47843d51cb9ddb741631f00
e5c9220b1b0fe6b440cd1dfae2ef303a1d00
e5c9220b1b0fe9dc3abb1d53e6b440cd1dfa
e47843d51cb9e6b440cd1dfae3ea4d261942
e6b440cd1dfaeba445b11d8ee3ea4d261942
f319586507affb43588c130700845b4407f5
f03d46091e76e3ea4d261942eba445b11d8e
ec8823f91a52ed282bd119dce5c9220b1b0f
ed282bd119dce9dc3abb1d53e5c9220b1b0f
f03d46091e76eb3c506f15d8e3ea4d261942
fb43588c1307f8e9556116adfcce50c91bb0
f8e9556116adebef55050f4ff03d46091e76
fcce50c91bb0f8e9556116adf03d46091e76
00845b4407f5fb43588c1307092058da10b1
00e6462f1e31fcce50c91bb0fbd845f11ef3
00845b4407f508ea598a081807ac5896fdd6
ede21b1a26d9f7ae20972191ec8823f91a52
064631842632fded3174280101372ba52688
08ca3b28257508d348461e62fd82404726b8
fdfb43f8238b08d348461e6200e6462f1e31
00e6462f1e310a5751a2188afcce50c91bb0
fd82404726b808d348461e62fdfb43f8238b
fd82404726b8eeb33f7922dbf5853b3927be
00845b4407f5092058da10b108ea598a0818
fded31742801fd82404726b8f5853b3927be
064631842632fd82404726b8fded31742801
ffdf1e701fd110961f1e1bb60398241224d4
ffdf1e701fd10398241224d4f7ae20972191
0398241224d401372ba52688f9422a57264a
f7ae209721910398241224d4f9422a57264a
01372ba52688fded31742801f9422a57264a
d39f55c020c9ca9662552083c9ad58c52529
d22c4e9721a2d39f55c020c9d02f51c5252c
d80f68041532d395671e1a2ed39f55c020c9
d3e04bf31a8dd39f55c020c9d22c4e9721a2
d9b260161560d80f68041532d39f55c020c9
de7556d31698d9b260161560d39f55c020c9
d3e04bf31a8dde7556d31698d39f55c020c9
dbe44fcd1706de7556d31698d3e04bf31a8d
08d348461e620ccb356b23e910cb3e0520eb
10d344291e6008d348461e6210cb3e0520eb
0398241224d406463184263201372ba52688
08d348461e6208ca3b2825750ccb356b23e9
fb43588c1307ebef55050f4ff8e9556116ad
06463184263208ca3b282575fd82404726b8
e6b440cd1dfaefa342071ed1f03d46091e76
f6e06f9af7a6f4347e3df2cbea43795dfd75
f6e06f9af7a6e0076c4105e8f0876d84fe48
0398241224d40e782acd20b90ccb356b23e9
08d348461e620a5751a2188a00e6462f1e31
18222eef1b0f10cb3e0520eb0e782acd20b9
0398241224d4107d24781d3f0e782acd20b9
f5e518262350f7ae20972191ede21b1a26d9
1bcf3069160718222eef1b0f197823bc172d
0646318426320ccb356b23e90b6a352124e1
10cb3e0520eb1c17417d154014dd435c1c03
1c063ad7162f1c17417d1540176837ab1c45
176837ab1c451c17417d154010cb3e0520eb
18222eef1b0f176837ab1c4510cb3e0520eb
1c17417d154019074cbe116f14dd435c1c03
18222eef1b0f0e782acd20b913a1275e1c7a
1c063ad7162f176837ab1c451bcf30691607
d39f55c020c9c9ad58c52529d02f51c5252c
f6e06f9af7a6ea43795dfd75ea9f776cfd08
e2d555891122e165579a0ed7de7556d31698
13a1275e1c7a0e782acd20b9107d24781d3f
10cb3e0520eb14dd435c1c0310d344291e60
1bcf306916071f6938710f251c063ad7162f
10961f1e1bb6107d24781d3f0398241224d4
14dd435c1c0319074cbe116f13464e35171a
0ccb356b23e908ca3b2825750b6a352124e1
e0076c4105e8f6e06f9af7a6ea9f776cfd08
14dd435c1c0313464e35171a10d344291e60
107d24781d3f10961f1e1bb613a1275e1c7a
14d31cb1141b197823bc172d18222eef1b0f
f7ae20972191f5e518262350ffdf1e701fd1
f6e06f9af7a6fa3372faf181f91f7770f091
0646318426320b6a352124e108ca3b282575
13464e35171a08d348461e6210d344291e60
13464e35171a0a5751a2188a08d348461e62
f6e06f9af7a6f91f7770f091f4347e3df2cb
13a1275e1c7a10961f1e1bb618222eef1b0f
14d31cb1141b18222eef1b0f10961f1e1bb6
0e782acd20b910cb3e0520eb0ccb356b23e9
1bcf30691607176837ab1c4518222eef1b0f
2545214510da26522b0013c4197823bc172d
ea9f776cfd08ea43795dfd75e0076c4105e8
1e4c38bdfde11e4f448f027a203a31e80440
f90374d6ee23f6e06f9af7a6ef4c6c6bf87b
2a832c15088427242443feba25d232ec09ed
1c17417d15401c063ad7162f1f6938710f25
dc4c6252ffd0f0876d84fe48de0b6607080b
203a31e804401e4f448f027a1e91435d04d0
1e4c38bdfde11b01432cfa4e1e4f448f027a
e0076c4105e8de0b6607080bf0876d84fe48
139e2913f1a813194288f24219ed3a87f560
1f7b3dfc05bc203a31e804401e91435d04d0
19ed3a87f5601e4c38bdfde11ad82aa8f8ea
114a1c8afac8139e2913f1a81ad82aa8f8ea
139e2913f1a819ed3a87f5601ad82aa8f8ea
1f6938710f251e9d3fda0dee1c17417d1540
1b3249ba0cad19074cbe116f1c17417d1540
2545214510da2a832c15088426522b0013c4
203a31e804401f7b3dfc05bc1e9d3fda0dee
1ad82aa8f8ea1e4c38bdfde11b1126a2fb14
26522b0013c42a832c15088425d232ec09ed
1e91435d04d01c17417d15401e9d3fda0dee
1f7b3dfc05bc1e91435d04d01e9d3fda0dee
203a31e804401e9d3fda0dee1f6938710f25
1b3249ba0cad1c17417d15401e91435d04d0
27242443feba2a832c150884288124e408af
27242443feba288124e408af2545214510da
2545214510da288124e408af2a832c150884
e3bb745df71aea43795dfd75f4347e3df2cb
dbe44fcd1706ddb741631f00e2d555891122
25d232ec09ed197823bc172d24f330a510a1
25d232ec09ed1bcf30691607197823bc172d
d9b260161560dbb562d90f7fda8f68a71253
e5c9220b1b0fe2ef303a1d00da133d261fab
cd277c56dc71d582720adf43d34c7de0d619
fbd845f11ef3f03d46091e76fb4b45082089
092058da10b1fb43588c1307fcce50c91bb0
d0176b9a0cf0c0cb68240c01cc326b270f1a
de0b6607080be0076c4105e8d8116b5606fb
1f6938710f251bcf3069160725d232ec09ed
0a5751a2188a097b563314fefcce50c91bb0
d8116b5606fbdc15686a09dfde0b6607080b
ebef55050f4feb3c506f15d8f03d46091e76
e3d1585dfdb6e165579a0ed7e86c57480a05
cbee6a9a0066d58b6b15f7f4cb046b64fa2d
e3d1585dfdb6e86c57480a05e96056d9025a
e3ea4d261942ebef55050f4fe2d555891122
e86c57480a05e165579a0ed7e2d555891122
cc326b270f1ac0cb68240c01c76e69711573
c0d84e500757be6d54d30fe3c1e35e7f0719
f319586507afebef55050f4ffb43588c1307
0646318426320398241224d40ccb356b23e9
dde95c9d00f2de0b6607080bdbb562d90f7f
159a50e110a913464e35171a19074cbe116f
197823bc172d26522b0013c424f330a510a1
25d232ec09ed203a31e804401f6938710f25
d582720adf43d65d7764d544d34c7de0d619
e96056d9025aecf65189f7ece3d1585dfdb6
f4347e3df2cbf2077ffff2aae3bb745df71a
1a7a4b49034019074cbe116f1e4f448f027a
ebef55050f4fe86c57480a05e2d555891122
104354ac11cf13464e35171a159a50e110a9
1e91435d04d01e4f448f027a1b3249ba0cad
d8116b5606fbc76e69711573d80f68041532
cd277c56dc71d58b6b15f7f4d6896c7bee07
1a7a4b49034015b0518c00c319074cbe116f
d80f68041532c76e69711573d4d16956175f
d0176b9a0cf0c76e69711573d8116b5606fb
15b0518c00c3159a50e110a919074cbe116f
cd277c56dc71ccea76c6e7b8cd537300f1a5
d0176b9a0cf0cbee6a9a0066c0cb68240c01
cd537300f1a5cb046b64fa2dd58b6b15f7f4
dbb562d90f7fdc15686a09dfda8f68a71253
d80f68041532d4d16956175fd395671e1a2e
d0176b9a0cf0cc326b270f1ac76e69711573
dc15686a09dfd80f68041532da8f68a71253
d45b68fcff99d0176b9a0cf0d8116b5606fb
dc15686a09dfd8116b5606fbd80f68041532
15b0518c00c3104354ac11cf159a50e110a9
d9b260161560da8f68a71253d80f68041532
104354ac11cf092058da10b113464e35171a
13464e35171a092058da10b10a5751a2188a
dbe44fcd1706e2d555891122de7556d31698
dbb562d90f7fd9b260161560de7556d31698
d582720adf43cd277c56dc71d6896c7bee07
00e6462f1e31fbd845f11ef3fdfb43f8238b
dc4c6252ffd0de0b6607080bdde95c9d00f2
d4d16956175fca9662552083d395671e1a2e
15244fddfcc00b445917034515b0518c00c3
0b4459170345092058da10b115b0518c00c3
092058da10b1104354ac11cf15b0518c00c3
e165579a0ed7dbb562d90f7fde7556d31698
e3d1585dfdb6dbb562d90f7fe165579a0ed7
c76e69711573ca9662552083d4d16956175f
092058da10b1097b563314fe0a5751a2188a
df9d589aff74dde95c9d00f2e3d1585dfdb6
1e4f448f027a19074cbe116f1b3249ba0cad
cbee6a9a0066d45b68fcff99d58b6b15f7f4
dde95c9d00f2dbb562d90f7fe3d1585dfdb6
f319586507afe86c57480a05ebef55050f4f
fbd845f11ef3fb4b45082089fdfb43f8238b
fb4b45082089f03d46091e76fdfb43f8238b
c1e35e7f0719c0cb68240c01cbee6a9a0066
dbb562d90f7fde0b6607080bdc15686a09df
fdfb43f8238beeb33f7922dbfd82404726b8
f8067d78eb62f4347e3df2cbf91f7770f091
cd537300f1a5d58b6b15f7f4cd277c56dc71
e0076c4105e8dd777247fe27d8116b5606fb
f03d46091e76eeb33f7922dbfdfb43f8238b
07ac5896fdd608ea598a08180b4459170345
097b563314fe092058da10b1fcce50c91bb0
092058da10b10b445917034508ea598a0818
e5c9220b1b0fe06a1ab51f6ae47417ef1ca9
f5f62ded2531f9422a57264af5853b3927be
f5f62ded2531f5853b3927beef2538192589
f9422a57264afded31742801f5853b3927be
cd97418c1c05d39237ab1e39d3e04bf31a8d
ea43795dfd75dd777247fe27e0076c4105e8
ef2538192589f5853b3927beeeb33f7922db
ea8718b00c8ee82317c51876e47417ef1ca9
efa342071ed1e6b440cd1dfae9dc3abb1d53
da133d261fabd3e04bf31a8dd39237ab1e39
e96c1bfc2333e5c9220b1b0fe47417ef1ca9
d6b31b4d20c9e06a1ab51f6adf152bb41907
d0904af819afcd97418c1c05d3e04bf31a8d
26522b0013c425d232ec09ed24f330a510a1
eb3c506f15d8ebef55050f4fe3ea4d261942
f3902b5e237cf7ae20972191f9422a57264a
e5c9220b1b0fe96c1bfc2333ec8823f91a52
c1bf55a01fc6c9ad58c52529ca9662552083
f5f62ded2531f3902b5e237cf9422a57264a
cb65508323bed02f51c5252cc9ad58c52529
ed282bd119dcf3902b5e237ce9dc3abb1d53
f03d46091e76efa342071ed1eeb33f7922db
eeb33f7922dbefa342071ed1e9dc3abb1d53
ef7828421cc6ec8823f91a52f3902b5e237c
ef2538192589eeb33f7922dbe9dc3abb1d53
fbd845f11ef3fcce50c91bb0f03d46091e76
cd537300f1a5ccea76c6e7b8c9ce6fffecc4
ed282bd119dcec8823f91a52ef7828421cc6
e9bd701af55be3bb745df71aeca67658f300
c61239b91354c83639c31775c53243c11360
e96c1bfc2333ede21b1a26d9ec8823f91a52
ef7828421cc6f3902b5e237ced282bd119dc
eba445b11d8ee6b440cd1dfaf03d46091e76
e9dc3abb1d53f3902b5e237cef2538192589
e5c9220b1b0fdf152bb41907e06a1ab51f6a
f3902b5e237cf5f62ded2531ef2538192589
e3bb745df71ae9bd701af55bef4c6c6bf87b
c83639c31775cd97418c1c05c53243c11360
ddb420e00b67dd5322b40d67dba32664089e
d87e23090400ddb420e00b67dba32664089e
cf6739891c8ccd97418c1c05c83639c31775
ca9662552083c49562531b3ac1bf55a01fc6
cd277c56dc71d0627cd2d81dd0627a9cd804
d2136b1bd9e1ce396e2be5a8d0627a9cd804
d0627a9cd804ce396e2be5a8cd277c56dc71
cc2767f0f340ce396e2be5a8ce396797e370
ce396e2be5a8cc2767f0f340cd277c56dc71
cc2767f0f340c9ce6fffecc4cd277c56dc71
d48c18900e0dd87e23090400d0181ea4034a
cd97418c1c05d0904af819afcd6f4a2c1caa
ccea76c6e7b8cd277c56dc71c9ce6fffecc4
ef0f2222ed6beaf64187eea5ea4f35c9e96b
ef0f2222ed6be6803ba2f076eaf64187eea5
d0627cd2d81dcd277c56dc71d34c7de0d619
ef0f2222ed6be72c31e3f3cde6803ba2f076
e72c31e3f3cdef0f2222ed6bebaa231df31d
e89e2477f8d5ebaa231df31de09d1c23f2a3
d0f165ebe717d2136b1bd9e1d582720adf43
d87e23090400d48c18900e0dddb420e00b67
d48c18900e0ddd5322b40d67ddb420e00b67
d11661c6f7cccb046b64fa2dcc2767f0f340
cb046b64fa2dc9ce6fffecc4cc2767f0f340
c12164b60f73c0cb68240c01c1e35e7f0719
c21f5e970ec6c12164b60f73c1e35e7f0719
c0275170131cc12164b60f73be6d54d30fe3
be6d54d30fe3c12164b60f73c21f5e970ec6
be6d54d30fe3c21f5e970ec6c1e35e7f0719
c234409a0f33c3513bd40459c61239b91354
c61239b91354c53243c11360c234409a0f33
d45b68fcff99cbee6a9a0066d0176b9a0cf0
c6b633ab043ec52e36900bbec3513bd40459
cb9e65a4f9fbcb046b64fa2dd11661c6f7cc
c61239b91354c3513bd40459c52e36900bbe
c8384b3a14efc0275170131cc37549ab0794
c12164b60f73c76e69711573c0cb68240c01
c234409a0f33c8384b3a14efc37549ab0794
c1bf55a01fc6c21a5afd185ac0275170131c
c21a5afd185ac12164b60f73c0275170131c
c7894c49ff7fcc7040c9f5ffc6303b82fcdd
bfd153491c8bc1bf55a01fc6c0275170131c
c234409a0f33c37549ab0794c3513bd40459
cb9e65a4f9fbca926557fcbdcb046b64fa2d
c49562531b3ac12164b60f73c1bf55a01fc6
d582720adf43d6896c7bee07d0f165ebe717
ea43795dfd75e3bb745df71add777247fe27
c5524afe036dc7894c49ff7fc6303b82fcdd
ca926557fcbdcbee6a9a0066cb046b64fa2d
d0e61952175dd6b31b4d20c9dd5322b40d67
c7dc5fc0feebcbee6a9a0066ca926557fcbd
c21a5afd185ac1bf55a01fc6c12164b60f73
ca2432bcfcbdc3513bd40459c6303b82fcdd
dc3229fc1440dd5322b40d67df152bb41907
d87e23090400da0f2ccff847daca2190fc58
ca2432bcfcbdc6b633ab043ec3513bd40459
c6303b82fcddc37549ab0794c5524afe036d
cfdf2bcfffdfc6b633ab043eca2432bcfcbd
c1e35e7f0719c7dc5fc0feebc4115807fe92
c3513bd40459c37549ab0794c6303b82fcdd
c5524afe036dc0d84e500757c7894c49ff7f
c1e35e7f0719cbee6a9a0066c7dc5fc0feeb
d87e23090400d53928160a2bda0f2ccff847
c0d84e500757c1e35e7f0719c7894c49ff7f
c1e35e7f0719c4115807fe92c7894c49ff7f
f8067d78eb62f91f7770f091fa3372faf181
f8067d78eb62f2077ffff2aaf4347e3df2cb
07ac5896fdd6f94d58ef01ba00845b4407f5
1a7a4b4903401e4f448f027a1b01432cfa4e
1e4c38bdfde1203a31e804401b1126a2fb14
d65d7764d544d2136b1bd9e1d34c7de0d619
ef4c6c6bf87bf0876d84fe48dc4c6252ffd0
26403015024a25d232ec09ed27242443feba
ef4c6c6bf87bf6e06f9af7a6f0876d84fe48
c6303b82fcddcc7040c9f5ffcb9d3da6f6b7
d39237ab1e39cd97418c1c05cf6739891c8c
15244fddfcc013b946a4f4eb0ed650d5f890
d87e23090400daca2190fc58d0181ea4034a
dba32664089edd5322b40d67dc9426610a27
d95d618cfe99dde95c9d00f2db925592f9d5
ebaa231df31def0f2222ed6be09d1c23f2a3
08b44e64f3f3fdf74d1ef1b9fca955c7f95a
f32754d4fbd1f8f5522bf65fecf65189f7ec
f94d58ef01ba07ac5896fdd6fca955c7f95a
13b946a4f4eb1b01432cfa4e13194288f242
dde95c9d00f2df9d589aff74db925592f9d5
df9d589aff74e24e5619f9dfdb925592f9d5
e7134f97f56ce41a4992f21bdb925592f9d5
1a7a4b4903401b01432cfa4e15b0518c00c3
eca67658f300e3bb745df71af2077ffff2aa
f8f5522bf65ff5394c47f256ecf65189f7ec
e96056d9025ae86c57480a05f32754d4fbd1
0ed650d5f8900b445917034515244fddfcc0
13194288f2420c7f458af0bb0827477df1a1
f3902b5e237cec8823f91a52f7ae20972191
e4d75150f693e7134f97f56cdb925592f9d5
0b44591703450ed650d5f89007ac5896fdd6
e4d75150f693db925592f9d5e24e5619f9df
e96056d9025af32754d4fbd1ecf65189f7ec
0ed650d5f89008b44e64f3f307ac5896fdd6
08b44e64f3f313194288f2420827477df1a1
15244fddfcc01b01432cfa4e13b946a4f4eb
0ed650d5f89013b946a4f4eb13194288f242
fca955c7f95af8f5522bf65ff32754d4fbd1
f319586507affca955c7f95af32754d4fbd1
f76d44bbef0ff7a13ac7e4bef0e43eb7e772
0ed650d5f89013194288f24208b44e64f3f3
1b01432cfa4e19ed3a87f56013194288f242
15b0518c00c31b01432cfa4e15244fddfcc0
26403015024a203a31e8044025d232ec09ed
df9d589aff74e3d1585dfdb6e24e5619f9df
e3d1585dfdb6e4d75150f693e24e5619f9df
0cdc40faef5307fc3da2eaba029d42f9ec6c
ecf65189f7eceea148cff03ceaf64187eea5
f94d58ef01bafca955c7f95af319586507af
27242443feba1b1126a2fb14203a31e80440
26403015024a27242443feba203a31e80440
e7134f97f56ce3d1585dfdb6ecf65189f7ec
e7134f97f56ceaf64187eea5e41a4992f21b
f5394c47f256eea148cff03cecf65189f7ec
029d42f9ec6cf8e44210ea02f76d44bbef0f
0003544df87bfca955c7f95a07ac5896fdd6
08b44e64f3f3fca955c7f95a0003544df87b
fdf74d1ef1b9f5394c47f256f8f5522bf65f
f76d44bbef0ff8e44210ea02f7a13ac7e4be
e7134f97f56cecf65189f7eceaf64187eea5
eaf64187eea5f76d44bbef0ff0e43eb7e772
fca955c7f95afdf74d1ef1b9f8f5522bf65f
e3d1585dfdb6e7134f97f56ce4d75150f693
f8e44210ea02029d42f9ec6cf7a13ac7e4be
07ac5896fdd608b44e64f3f30003544df87b
fdf74d1ef1b9f76d44bbef0ff5394c47f256
e86c57480a05f319586507aff32754d4fbd1
ea8718b00c8ee47417ef1ca9e45118a307de
22142018fdc71b1126a2fb1427242443feba
cd7b3857f59ec6303b82fcddcb9d3da6f6b7
e6803ba2f076e0db40ccf0c2eaf64187eea5
22142018fdc71a731ea4fbb91b1126a2fb14
ca926557fcbdcb9e65a4f9fbd11661c6f7cc
1ad82aa8f8ea1b1126a2fb141a731ea4fbb9
1a731ea4fbb9114a1c8afac81ad82aa8f8ea
cb046b64fa2dcd537300f1a5c9ce6fffecc4
de2b48b5f277d7a54ccef4d1db925592f9d5
de2b48b5f277db925592f9d5e41a4992f21b
cfbe5e97fa09d11661c6f7ccd95d618cfe99
d0627a9cd804d34c7de0d619d2136b1bd9e1
dc4c6252ffd0da07694ffe60e3bb745df71a
ca926557fcbdcfbe5e97fa09c7dc5fc0feeb
ef4c6c6bf87bdc4c6252ffd0e3bb745df71a
c49562531b3ac76e69711573c12164b60f73
eaf64187eea5eea148cff03cede64493ef98
ca2432bcfcbdcd7b3857f59ed9832d77f722
029d42f9ec6cfe063879e615f7a13ac7e4be
139e2913f1a80d442b47ec51111a32b3ee9b
0b8718eff2390d442b47ec51114a1c8afac8
e72c31e3f3cdebaa231df31de89e2477f8d5
111a32b3ee9b13194288f242139e2913f1a8
c6303b82fcddcd7b3857f59eca2432bcfcbd
0b8718eff23907692a19ea950d442b47ec51
e3bb745df71ada07694ffe60dd777247fe27
111a32b3ee9b0d442b47ec510cdc40faef53
0827477df1a10c7f458af0bb0cdc40faef53
139e2913f1a8114a1c8afac80d442b47ec51
d11661c6f7ccd45b68fcff99d95d618cfe99
ef0f2222ed6bea4f35c9e96bef533689e52f
05e14861f1e908b44e64f3f30827477df1a1
f6e06f9af7a6f90374d6ee23fa3372faf181
08b44e64f3f3051d4cbff274fdf74d1ef1b9
f76d44bbef0feaf64187eea5ede64493ef98
c7894c49ff7fce195845f9a5cd104ef4fb28
07692a19ea9507fc3da2eaba0d442b47ec51
051d4cbff27408b44e64f3f305e14861f1e9
0b8718eff23904df2092ed7107692a19ea95
fdf74d1ef1b9051d4cbff27405e14861f1e9
02903717e84407fc3da2eaba07692a19ea95
df492268f9b4da0f2ccff847e89e2477f8d5
0cdc40faef5305e14861f1e90827477df1a1
02fe1ba7eebe07692a19ea9504df2092ed71
fe063879e61502903717e84407692a19ea95
029d42f9ec6c07fc3da2eaba02903717e844
dd777247fe27da07694ffe60d45b68fcff99
de3b3f29f11fe0db40ccf0c2e6803ba2f076
05e14861f1e90cdc40faef53029d42f9ec6c
fdf74d1ef1b905e14861f1e9026d4a00f218
029d42f9ec6c026d4a00f21805e14861f1e9
fe063879e615029d42f9ec6c02903717e844
e72c31e3f3cdd9832d77f722e6803ba2f076
ce195845f9a5c7dc5fc0feebcfbe5e97fa09
cfbe5e97fa09ca926557fcbdd11661c6f7cc
f80c2b0fe71dfe063879e61507692a19ea95
daca2190fc58da0f2ccff847df492268f9b4
daca2190fc58df492268f9b4e0f21ec9f86d
02fe1ba7eebef7a51f4beb9b07692a19ea95
f7a51f4beb9bf80c2b0fe71d07692a19ea95
029d42f9ec6cf76d44bbef0ffdf74d1ef1b9
e09d1c23f2a3daca2190fc58e0f21ec9f86d
f84d1763eeea02fe1ba7eebefe9f167ff0e0
f80c2b0fe71dfb7b3849e5d4fe063879e615
e772175cea99e09d1c23f2a3ef0f2222ed6b
d95d618cfe99da07694ffe60dc4c6252ffd0
cd104ef4fb28cc7040c9f5ffc7894c49ff7f
f84d1763eeeaf80c1d7aedde02fe1ba7eebe
da0f2ccff847d9832d77f722e72c31e3f3cd
07fc3da2eaba0cdc40faef530d442b47ec51
f80c1d7aeddef7a51f4beb9b02fe1ba7eebe
ce195845f9a5d0c3524df9f3ce124d24f9e1
d60a52cff9d3d8235dabfc08db925592f9d5
ca2432bcfcbdd9832d77f722cfdf2bcfffdf
f80c2b0fe71df7a13ac7e4befb7b3849e5d4
fe063879e615fb7b3849e5d4f7a13ac7e4be
026d4a00f218029d42f9ec6cfdf74d1ef1b9
cd104ef4fb28ce195845f9a5ce124d24f9e1
d6c43795f1c7de3b3f29f11fe6803ba2f076
e0f21ec9f86de89e2477f8d5e09d1c23f2a3
d60a52cff9d3ce195845f9a5d8235dabfc08
d7a54ccef4d1d60a52cff9d3db925592f9d5
ea8718b00c8ee8bb18e10305ee691a58ff92
e09d1c23f2a3e017176af2f0dd901700f6ac
04df2092ed710b8718eff23902fe1ba7eebe
ce195845f9a5cfbe5e97fa09d8235dabfc08
d95d618cfe99d45b68fcff99da07694ffe60
1b01432cfa4e1e4c38bdfde119ed3a87f560
ce361739fd84d0181ea4034adaca2190fc58
cc7040c9f5ffcd104ef4fb28ce124d24f9e1
13194288f242111a32b3ee9b0cdc40faef53
f2c22c92e67bf7a13ac7e4bef80c2b0fe71d
f5394c47f256f76d44bbef0feea148cff03c
eba11a24136ee82317c51876ea8718b00c8e
f84d1763eeeaf7a51f4beb9bf80c1d7aedde
f2c22c92e67bf80c2b0fe71df7a51f4beb9b
d34c7de0d619d0627a9cd804d0627cd2d81d
c4115807fe92ce195845f9a5c7894c49ff7f
f2c22c92e67bef533689e52ff7a13ac7e4be
cd7b3857f59ecc7040c9f5ffd6c43795f1c7
d9204135f10bde2b48b5f277e41a4992f21b
d9204135f10bd7a54ccef4d1de2b48b5f277
ce195845f9a5c4115807fe92c7dc5fc0feeb
ef84229eecb4f2c22c92e67bf7a51f4beb9b
cfdf2bcfffdfd9832d77f722da0f2ccff847
e0db40ccf0c2e41a4992f21beaf64187eea5
ef4c6c6bf87bf8067d78eb62f90374d6ee23
cc2767f0f340ce396797e370d2136b1bd9e1
d9204135f10be41a4992f21be0db40ccf0c2
ef533689e52ff0e43eb7e772f7a13ac7e4be
eca67658f300f8067d78eb62ef4c6c6bf87b
f5531886f049e772175cea99f7a51f4beb9b
ce361739fd84daca2190fc58dd901700f6ac
ce124d24f9e1d9204135f10bd6c43795f1c7
d95d618cfe99d8235dabfc08cfbe5e97fa09
dd5322b40d67d48c18900e0dd48a17981017
d9204135f10bce124d24f9e1d7a54ccef4d1
0cdc40faef530c7f458af0bb13194288f242
e89e2477f8d5da0f2ccff847e72c31e3f3cd
daca2190fc58e09d1c23f2a3dd901700f6ac
d9832d77f722d6c43795f1c7e6803ba2f076
cd7b3857f59ed6c43795f1c7d9832d77f722
d0e61952175ddd5322b40d67d48a17981017
e9bd701af55beca67658f300ef4c6c6bf87b
d6c43795f1c7cc7040c9f5ffce124d24f9e1
ef533689e52fee253bc8e6fdf0e43eb7e772
c53243c11360c8384b3a14efc234409a0f33
fa3372faf181f90374d6ee23f8067d78eb62
cd7b3857f59ecb9d3da6f6b7cc7040c9f5ff
e0f21ec9f86ddf492268f9b4e89e2477f8d5
ef0f2222ed6bf2c22c92e67bef84229eecb4
d7a54ccef4d1ce195845f9a5d60a52cff9d3
ce124d24f9e1d0c3524df9f3d7a54ccef4d1
d11661c6f7ccd0f165ebe717d6896c7bee07
de3b3f29f11fd9204135f10be0db40ccf0c2
f8067d78eb62eca67658f300f2077ffff2aa
d7a54ccef4d1d0c3524df9f3ce195845f9a5
e772175cea99ef0f2222ed6bf7a51f4beb9b
ef0f2222ed6bef84229eecb4f7a51f4beb9b
ef0f2222ed6bef533689e52ff2c22c92e67b
f0e43eb7e772ee253bc8e6fdeaf64187eea5
f5531886f049f7a51f4beb9bf84d1763eeea
d6c43795f1c7d9204135f10bde3b3f29f11f
ef533689e52fea4f35c9e96bee253bc8e6fd
ea4f35c9e96beaf64187eea5ee253bc8e6fd
d39237ab1e39cf6739891c8ccf0b313217dc
114a1c8afac813b9176b08ef0d671768ff89
02fe1ba7eebe058618e6f6f0fe9f167ff0e0
de4731901bdee5c9220b1b0fda133d261fab
14d31cb1141b18771d5613b6197823bc172d
d95d618cfe99dc4c6252ffd0dde95c9d00f2
c37549ab0794c0275170131cc0d84e500757
d2136b1bd9e1d65d7764d544d582720adf43
ca9662552083d39f55c020c9d395671e1a2e
22142018fdc727242443feba2545214510da
cd6f4a2c1caac9ad58c52529c1bf55a01fc6
c0d84e500757c0275170131cbe6d54d30fe3
f9c117f31cee05131964181d06a817e91eba
14d31cb1141b06a817e91eba0a9d17b9159a
0b8718eff23907ad181ef93b02fe1ba7eebe
c8384b3a14efc41f4cd81dbcc0275170131c
2545214510da197823bc172d1c371e331368
c5524afe036dc37549ab0794c0d84e500757
d39237ab1e39de4731901bdeda133d261fab
07c71847073effe917a80852053517770232
1c371e331368197823bc172d1b6f1c7b1170
0d671768ff8913b9176b08ef0e5d18a305c5
cd6f4a2c1caac41f4cd81dbcc8384b3a14ef
c0275170131cc41f4cd81dbcbfd153491c8b
cd97418c1c05c8384b3a14efc53243c11360
c7ad4d4a1fd0c41f4cd81dbccd6f4a2c1caa
c7ad4d4a1fd0c1bf55a01fc6c41f4cd81dbc
c52e36900bbecaac31ae11e4c61239b91354
d11661c6f7ccd6896c7bee07d58b6b15f7f4
c61239b91354caac31ae11e4c83639c31775
f63c1a9d15f5ee961ab9198efdb91a510c67
10961f1e1bb606a817e91eba14d31cb1141b
d0181ea4034ace361739fd84d48c18900e0d
ce812b820b34caac31ae11e4c6b633ab043e
fe9f167ff0e0fccd1ae2f662f59b1745f263
cd6f4a2c1caac8384b3a14efcd97418c1c05
c1bf55a01fc6c7ad4d4a1fd0cd6f4a2c1caa
ca9662552083c76e69711573c49562531b3a
fccd1ae2f662f8d41acaf5c5f59b1745f263
cfdf2bcfffdfd22d298e03b8ce812b820b34
cd6f4a2c1caacb65508323bec9ad58c52529
f8d41acaf5c5ea8718b00c8ef3861a9ef4ac
ccb930b6146ecaac31ae11e4ce812b820b34
d11661c6f7ccd58b6b15f7f4d45b68fcff99
ccb930b6146ec83639c31775caac31ae11e4
cb65508323becd6f4a2c1caad02f51c5252c
d22d298e03b8d53928160a2bce812b820b34
0d671768ff8907c71847073e053517770232
06a817e91ebaffdf1e701fd1f5e518262350
d0904af819afd22c4e9721a2cd6f4a2c1caa
d6b31b4d20c9df152bb41907dd5322b40d67
ce812b820b34cf0b313217dcccb930b6146e
ede21b1a26d9e96c1bfc2333e47417ef1ca9
c83639c31775cf0b313217dccf6739891c8c
f9c117f31ceef5e518262350e82317c51876
d8235dabfc08d95d618cfe99db925592f9d5
fdb91a510c67ee961ab9198eeba11a24136e
d3e04bf31a8dd22c4e9721a2d0904af819af
d02f51c5252ccd6f4a2c1caad22c4e9721a2
ea8718b00c8eee691a58ff92f3861a9ef4ac
c6b633ab043ecaac31ae11e4c52e36900bbe
d0d530b01884cf0b313217dcce812b820b34
02fe1ba7eebe07ad181ef93b058618e6f6f0
df152bb41907e5c9220b1b0fde4731901bde
f59b1745f263f8d41acaf5c5f3861a9ef4ac
22142018fdc713b9176b08ef1a731ea4fbb9
d53928160a2bd4792a1c0fa3ce812b820b34
d4792a1c0fa3d0d530b01884ce812b820b34
eea148cff03cf76d44bbef0fede64493ef98
1b6f1c7b1170197823bc172d17ea1a841059
0a9d17b9159a06a817e91eba05131964181d
0a9d17b9159a063518bb12b913b9176b08ef
cf0b313217dcc83639c31775ccb930b6146e
d61417270afed48c18900e0dce361739fd84
dd777247fe27d45b68fcff99d8116b5606fb
d4792a1c0fa3d53928160a2bdba32664089e
197823bc172d18771d5613b617ea1a841059
d4792a1c0fa3d7f12d1117cfd0d530b01884
cfdf2bcfffdfda0f2ccff847d22d298e03b8
dc3229fc1440d9ce2d8e18bfdd5322b40d67
07ad181ef93b01151af6fc31058618e6f6f0
0b8718eff23905351777023207ad181ef93b
0d671768ff890b8718eff239114a1c8afac8
14d31cb1141b0a9d17b9159a13b9176b08ef
dba32664089edc9426610a27d4792a1c0fa3
063518bb12b9fd851ad9165afdb91a510c67
d61417270afece361739fd84dd901700f6ac
01151af6fc3107ad181ef93bfbaf1a6d0817
d7f12d1117cfd50d334a1c09d0d530b01884
07ad181ef93bffe917a80852fbaf1a6d0817
d48c18900e0dd61417270afed48a17981017
063518bb12b9fdb91a510c67ffe917a80852
13b9176b08ef063518bb12b907c71847073e
d50d334a1c09d7f12d1117cfd39237ab1e39
dd5322b40d67d7f12d1117cfd4792a1c0fa3
f5e518262350e47417ef1ca9e82317c51876
e772175cea99e017176af2f0e09d1c23f2a3
e772175cea99dd901700f6ace017176af2f0
cc2767f0f340d2136b1bd9e1d0f165ebe717
d9ce2d8e18bfd7f12d1117cfdd5322b40d67
da8e1784128cd48a17981017d61417270afe
d7f12d1117cfd9ce2d8e18bfd39237ab1e39
ffe917a80852fdb91a510c67fbaf1a6d0817
da8e1784128cd0e61952175dd48a17981017
d87e23090400dba32664089ed53928160a2b
d53928160a2bd22d298e03b8da0f2ccff847
e16a1705041bd61417270afedd901700f6ac
bfd153491c8bc41f4cd81dbcc1bf55a01fc6
d61417270afee45118a307deda8e1784128c
ce812b820b34c6b633ab043ecfdf2bcfffdf
ee961ab9198ee82317c51876eba11a24136e
d643186b1f69d6b31b4d20c9d0e61952175d
e69c1942f6acdd901700f6ace772175cea99
df152bb41907d9ce2d8e18bfdc3229fc1440
df152bb41907de4731901bded9ce2d8e18bf
de4731901bded39237ab1e39d9ce2d8e18bf
cc2767f0f340d0f165ebe717d11661c6f7cc
e69c1942f6ace8bb18e10305dd901700f6ac
e8bb18e10305e16a1705041bdd901700f6ac
e16a1705041be45118a307ded61417270afe
d643186b1f69d0e61952175dda8e1784128c
14d31cb1141b13b9176b08ef17ea1a841059
d6b31b4d20c9d643186b1f69da8e1784128c
dc9426610a27dd5322b40d67d4792a1c0fa3
01151af6fc31fccd1ae2f662058618e6f6f0
e45118a307dedefc17b214e9da8e1784128c
06a817e91ebaf5e518262350f9c117f31cee
0a9d17b9159a05131964181dfd851ad9165a
f5531886f049e69c1942f6ace772175cea99
13b9176b08ef07c71847073e0e5d18a305c5
1b6f1c7b117017ea1a8410592545214510da
ce396e2be5a8d2136b1bd9e1ce396797e370
f6251a500aa9ea8718b00c8efbaf1a6d0817
17ea1a84105918771d5613b614d31cb1141b
e16a1705041bea8718b00c8ee45118a307de
1a731ea4fbb913b9176b08ef114a1c8afac8
0a9d17b9159afd851ad9165a063518bb12b9
fdb91a510c67eba11a24136eea8718b00c8e
01151af6fc31f8d41acaf5c5fccd1ae2f662
05131964181dee961ab9198ef63c1a9d15f5
e8bb18e10305ea8718b00c8ee16a1705041b
d39237ab1e39d0d530b01884d50d334a1c09
2545214510da17ea1a84105913b9176b08ef
f6251a500aa9fdb91a510c67ea8718b00c8e
f84d1763eeeafe9f167ff0e0f59b1745f263
10961f1e1bb6ffdf1e701fd106a817e91eba
01151af6fc31fbaf1a6d0817f8d41acaf5c5
0e5d18a305c507c71847073e0d671768ff89
dd9b17ef1e98e06a1ab51f6ad6b31b4d20c9
da8e1784128cdd9b17ef1e98d6b31b4d20c9
2545214510da1c371e3313681b6f1c7b1170
07ad181ef93b053517770232ffe917a80852
fd851ad9165a05131964181df63c1a9d15f5
ef771a9df415e69c1942f6acf5531886f049
ee691a58ff92e8bb18e10305e69c1942f6ac
0d671768ff890535177702320b8718eff239
d39237ab1e39cf0b313217dcd0d530b01884
fe9f167ff0e0058618e6f6f0fccd1ae2f662
e47417ef1ca9defc17b214e9e45118a307de
e47417ef1ca9da8e1784128cdefc17b214e9
e06a1ab51f6add9b17ef1e98da8e1784128c
063518bb12b9ffe917a8085207c71847073e
ede21b1a26d9e47417ef1ca9f5e518262350
fbaf1a6d0817fdb91a510c67f6251a500aa9
fbaf1a6d0817ea8718b00c8ef8d41acaf5c5
22142018fdc72545214510da13b9176b08ef
fdb91a510c67fd851ad9165af63c1a9d15f5
f84d1763eeeaf59b1745f263f5531886f049
f5531886f049f59b1745f263f3861a9ef4ac
f5531886f049f3861a9ef4acef771a9df415
f3861a9ef4acee691a58ff92ef771a9df415
ee691a58ff92e69c1942f6acef771a9df415
e47417ef1ca9e06a1ab51f6ada8e1784128c
]])
:gsub('%s', '')

-- holds sets of 12 hex chars = 1 vertex xyz in int16_t
local vtxstrs = table()
for vtxstr in meshstr:gmatch(('.'):rep(12)) do
	vtxstrs:insert(vtxstr)
end

-- gather unique vtx strings
local uniquevtxstrs = vtxstrs:mapi(|vs| (true, vs)):keys()

-- convert to vertexes {x,y,z}
local vtxs = uniquevtxstrs:mapi(|vs| do
	local v = table()
	for i=1,#vs,4 do
		v:insert(tonumber(
			int16_t(tonumber(vs:sub(i, i+3), 16))
		))
	end
	assert.len(v, 3)
	return vec3d(table.unpack(v))
end)
-- get mapping from vertex string to index in vtxs
local vtxIndexForStr = uniquevtxstrs:mapi(|vs,ip1| (ip1-1, vs)):setmetatable(nil)

local indexes = table()
for _,vtxstr in ipairs(vtxstrs) do
	indexes:insert((assert.index(vtxIndexForStr, vtxstr)))
end



-- find volume center and offset to there
local calcCOM=||do
	local com = vec3d()
	local vol = 0
	for i=1,#indexes,3 do
		local v1 = vtxs[1+indexes[i]]
		local v2 = vtxs[1+indexes[i+1]]
		local v3 = vtxs[1+indexes[i+2]]
		local tetvol = v1:dot(v2:cross(v3)) / 6	-- det|v1, v2, v3| / 6
		vol += tetvol
		com += (v1 + v2 + v3) * (tetvol / 4)	-- /4 because we include (0,0,0) as a tetrahedron vertex
	end
	com /= vol
	return com, vol
end
-- get COM
local com, vol = calcCOM()
print('vol', vol)
print('com', com)
-- offset to zero
for i=1,#vtxs do
	vtxs[i] = vtxs[i] - com
end
-- verify it's zero or close enough
local com, vol = calcCOM()
print('vol', vol)
print('com', com)
-- find backfacing tris (why are they here?)
-- assumes the COM is zero
local flipBackFacing=||do
	local numBack = 0
	for i=1,#indexes,3 do
		local v1 = vtxs[1+indexes[i]]
		local v2 = vtxs[1+indexes[i+1]]
		local v3 = vtxs[1+indexes[i+2]]
		local c = (v1+v2+v3):unit()
		local n = (v2-v1):cross(v3-v2):unit()
		if c:dot(n) < 0 then
			numBack+=1
	--print'!!! backfacing tri !!!'
			indexes[i], indexes[i+1] = indexes[i+1], indexes[i]
		end
	end
	return numBack
end
print('num backfacing', flipBackFacing())
-- get COM
local com, vol = calcCOM()
print('vol', vol)
print('com', com)
-- offset to zero
for i=1,#vtxs do
	vtxs[i] = vtxs[i] - com
end
-- verify it's zero or close enough
local com, vol = calcCOM()
print('vol', vol)
print('com', com)
print('num backfacing', flipBackFacing())



local o = require 'ffi.cpp.vector-lua' 'int16_t'
o:emplace_back()[0] = #vtxs
o:emplace_back()[0] = #indexes
for j,vtx in ipairs(vtxs) do
	-- TODO how about a solid-face format as well? for tri3d() ?
	for i=0,2 do
		o:emplace_back()[0] = math.clamp(vtx.s[i], -32768, 32767)
	end
	-- uv
	if j % 3 == 0 then
		o:emplace_back()[0] = 0x0800
	elseif j % 3 == 1 then
		o:emplace_back()[0] = 0x0000
	elseif j % 3 == 2 then
		o:emplace_back()[0] = 0x0008
	end
end
for _,index in ipairs(indexes) do
	o:emplace_back()[0] = index
end
assert.eq(2 + #vtxs * 4 + #indexes, #o)
assert(path'mesh.3d':write(o:dataToStr()))
